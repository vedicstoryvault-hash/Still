<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Still Breathing Anchor</title>
  <style>
    :root {
      --teal: #006D77;
      --linen: #FDFCF0;
      --box-size: 240px; 
      --dot-size: 16px;
      --cycle-time: 16s; 
    }

    /* Standardizes how widths are calculated to prevent left-alignment shift */
    * { box-sizing: border-box; }

    html, body {
      margin: 0; padding: 0; width: 100%; height: 100%;
      background-color: var(--linen);
      overflow: hidden; position: fixed;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      color: var(--teal);
      display: flex; flex-direction: column; 
      align-items: center; /* Forces horizontal centering */
      justify-content: center; /* Forces vertical centering */
    }

    /* --- Setup Screen UI --- */
    #setup-container {
      text-align: center; 
      width: 85%; /* Slightly wider for better mobile feel */
      max-width: 320px;
      display: flex; 
      flex-direction: column; 
      gap: 25px;
      margin: 0 auto; /* Safety centering */
    }

    h1 { font-weight: 400; font-size: 26px; margin-bottom: 5px; }
    
    .input-group { width: 100%; text-align: left; }
    
    label { 
      font-size: 12px; letter-spacing: 1px; 
      color: rgba(0, 109, 119, 0.7); margin-bottom: 8px; display: block;
    }

    select {
      width: 100%; padding: 16px; border-radius: 12px;
      border: 1.5px solid rgba(0, 109, 119, 0.2); 
      background-color: #FFFFFF; color: var(--teal);
      font-size: 12px; appearance: none; -webkit-appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23006D77' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat; background-position: right 15px center; background-size: 14px;
      outline: none;
    }

    .start-button {
      background-color: var(--teal); color: white;
      border: none; padding: 18px; border-radius: 40px;
      font-size: 16px; font-weight: 600; cursor: pointer;
      margin-top: 10px; box-shadow: 0 4px 15px rgba(0, 109, 119, 0.2);
    }

    /* --- Active Breathing UI --- */
    #active-container {
      display: none; flex-direction: column; align-items: center;
      opacity: 0; transition: opacity 1s ease;
    }

    .timer-display { font-size: 18px; margin-bottom: 30px; letter-spacing: 2px; }

    .box-container {
      width: var(--box-size); height: var(--box-size);
      position: relative; border: 1.5px solid rgba(0, 109, 119, 0.3); border-radius: 12px;
      display: flex; justify-content: center; align-items: center;
    }

    .dot {
      width: var(--dot-size); height: var(--dot-size);
      background-color: var(--teal); border-radius: 50%;
      position: absolute; top: -8px; left: -8px;
      animation: moveAround var(--cycle-time) linear infinite;
      animation-play-state: paused;
    }

    .instruction-text {
      font-size: 18px; font-weight: 500; letter-spacing: 2px; text-transform: uppercase;
    }

    @keyframes moveAround {
      0%   { top: -8px; left: -8px; }
      25%  { top: -8px; left: 232px; }
      50%  { top: 232px; left: 232px; }
      75%  { top: 232px; left: -8px; }
      100% { top: -8px; left: -8px; }
    }

    #completion-message { display: none; text-align: center; padding: 20px; }
  </style>
</head>
<body>

  <div id="setup-container">
    <h1>Ready to anchor?</h1>
    <div class="input-group">
      <label>Breathing Rhythm</label>
      <select id="rhythm-select">
        <option value="16">Relaxed (4s pace)</option>
        <option value="24">Deep (6s pace)</option>
        <option value="32">Profound (8s pace)</option>
      </select>
    </div>
    <div class="input-group">
      <label>Session Duration</label>
      <select id="duration-select">
        <option value="60">1 Minute</option>
        <option value="180">3 Minutes</option>
        <option value="300">5 Minutes</option>
      </select>
    </div>
    <button class="start-button" onclick="startBreathing()">Begin Session</button>
  </div>

  <div id="active-container">
    <div class="timer-display" id="countdown">00:00</div>
    <div class="box-container">
      <div class="dot" id="moving-dot"></div>
      <div class="instruction-text" id="instruction">...</div>
    </div>
  </div>

  <div id="completion-message">
    <h1>You are centered.</h1>
    <p>The noise has settled.</p>
  </div>

  <script>
    // --- Audio Setup ---
    // Using a high-quality Tanpura Drone Loop
    const tanpura = new Audio('https://vedicstoryvault-hash.github.io/Still/tibetan-singing-bowl-relaxation-journey-384707.mp3');
    tanpura.loop = true;
    tanpura.volume = 0.7;

    let totalTime, cycleTime, countdownInterval, textInterval;
    const phases = ["Inhale", "Hold", "Exhale", "Hold"];

    function startBreathing() {
      // Start Tanpura immediately on user click
      tanpura.play().catch(e => console.log("Audio blocked: ", e));

      cycleTime = parseInt(document.getElementById('rhythm-select').value);
      totalTime = parseInt(document.getElementById('duration-select').value);
      document.documentElement.style.setProperty('--cycle-time', cycleTime + 's');

      document.getElementById('setup-container').style.display = 'none';
      const active = document.getElementById('active-container');
      active.style.display = 'flex';
      setTimeout(() => active.style.opacity = 1, 50);
      
      runSession();
    }

    function runSession() {
      document.getElementById('moving-dot').style.animationPlayState = 'running';
      updateTimerDisplay(totalTime);
      
      let phaseIndex = 0;
      document.getElementById('instruction').innerText = phases[0];
      
      textInterval = setInterval(() => {
        phaseIndex = (phaseIndex + 1) % phases.length;
        document.getElementById('instruction').innerText = phases[phaseIndex];
      }, (cycleTime / 4) * 1000);

      countdownInterval = setInterval(() => {
        totalTime--;
        updateTimerDisplay(totalTime);
        if (totalTime <= 0) endSession();
      }, 1000);
    }

    function updateTimerDisplay(sec) {
      const m = Math.floor(sec / 60).toString().padStart(2, '0');
      const s = (sec % 60).toString().padStart(2, '0');
      document.getElementById('countdown').innerText = `${m}:${s}`;
    }

    function endSession() {
      clearInterval(countdownInterval);
      clearInterval(textInterval);
      tanpura.pause(); // Stop music at end
      document.getElementById('active-container').style.display = 'none';
      document.getElementById('completion-message').style.display = 'block';
    }
  </script>
</body>
</html>
